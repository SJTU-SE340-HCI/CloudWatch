{"remainingRequest":"D:\\HCI\\github\\node_modules\\babel-loader\\lib\\index.js!D:\\HCI\\github\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\HCI\\github\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\HCI\\github\\src\\components\\voice.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\HCI\\github\\src\\components\\voice.vue","mtime":1593418846942},{"path":"D:\\HCI\\github\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589122691350},{"path":"D:\\HCI\\github\\node_modules\\babel-loader\\lib\\index.js","mtime":1589122690916},{"path":"D:\\HCI\\github\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589122691350},{"path":"D:\\HCI\\github\\node_modules\\vue-loader\\lib\\index.js","mtime":1589122702780}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport TRTC from 'trtc-js-sdk';\nimport { TEST_ACCOUNT } from \"../const/account_dev\";\nimport { mapState } from 'vuex';\nexport default {\n  name: 'voiceCommunicate',\n  components: {},\n  data: function data() {\n    return {\n      sdkAppId: TEST_ACCOUNT.sdkAppId,\n      userId: TEST_ACCOUNT.userId + (Math.random() * 100).toFixed(),\n      userToken: TEST_ACCOUNT.userToken,\n      client: '',\n      localStream: '',\n      roomId: this.$store.state.currentRoomId,\n      remoteVideo: [],\n      isSignUp: false,\n      isLink: false\n    };\n  },\n  created: function created() {},\n  methods: {\n    voicecommunicate: function voicecommunicate(linkOrder) {\n      if (this.isLink == false && linkOrder == true) {\n        this.isLink = true;\n        this.createClient();\n      } else {\n        if (this.isLink == true && linkOrder == false) {\n          this.isLink == false;\n          this.signOut();\n        }\n      }\n    },\n    createClient: function createClient() {\n      //获取签名\n      var config = this.genTestUserSig();\n      var sdkAppId = config.sdkAppId;\n      var userSig = config.userSig;\n      this.client = TRTC.createClient({\n        mode: 'videoCall',\n        sdkAppId: sdkAppId,\n        userId: this.userId,\n        userSig: userSig\n      });\n      console.log(sdkAppId, this.userId, userSig, 111111111); //注册远程监听，要放在加入房间前--这里用了发布订阅模式\n\n      this.subscribeStream();\n      this.joinRoom(this.roomId);\n    },\n    //加入房间\n    joinRoom: function joinRoom(roomId) {\n      var _this = this;\n\n      console.log(roomId);\n\n      if (!this.isSignUp) {\n        this.client.join({\n          roomId: roomId\n        }).then(function () {\n          console.log('进房成功');\n          _this.isSignUp = true; //创建本地流\n\n          _this.createStream(_this.userId); // //播放远端流\n\n\n          _this.playRemoteStream(_this.client);\n\n          _this.isLink = true;\n        }).catch(function (error) {\n          console.error('进房失败 ' + error);\n        });\n      } else {\n        alert('不能重复加入直播间');\n      }\n    },\n    createStream: function createStream(userId) {\n      var _this2 = this;\n\n      var localStream = TRTC.createStream({\n        userId: userId,\n        audio: true,\n        video: false\n      });\n      this.localStream = localStream;\n      localStream.initialize().catch(function (error) {\n        console.error('初始化本地流失败 ' + error);\n      }).then(function () {\n        console.log('初始化本地流成功');\n        localStream.play('local_stream'); //创建好后才能发布\n\n        _this2.publishStream(localStream);\n      });\n    },\n    publishStream: function publishStream(localStream) {\n      this.client.publish(localStream).catch(function (error) {\n        console.error('本地流发布失败 ' + error);\n      }).then(function () {\n        console.log('本地流发布成功');\n      });\n    },\n    playRemoteStream: function playRemoteStream() {\n      var _this3 = this;\n\n      this.client.on('stream-subscribed', function (event) {\n        var remoteStream = event.stream;\n        console.log('远端流订阅成功：' + remoteStream.getId());\n\n        _this3.remoteVideo.push(remoteStream.getId()); // 播放远端流\n\n\n        _this3.$nextTick(function () {\n          remoteStream.play('remote_stream' + remoteStream.getId());\n        }, 1000);\n      });\n    },\n    //订阅远端流--加入房间之前\n    subscribeStream: function subscribeStream() {\n      var _this4 = this;\n\n      this.client.on('stream-added', function (event) {\n        var remoteStream = event.stream;\n        console.log('远端流增加: ' + remoteStream.getId()); //订阅远端流\n\n        _this4.client.subscribe(remoteStream);\n      });\n    },\n    signOut: function signOut() {\n      var _this5 = this;\n\n      this.isSignUp = false;\n      this.remoteVideo = [];\n      this.client.leave().then(function () {\n        // 退房成功，可再次调用client.join重新进房开启新的通话。\n        console.log('退出直播间');\n        _this5.isLink = false;\n      }).catch(function (error) {\n        console.error('退出直播间失败 ' + error); // 错误不可恢复，需要刷新页面。\n      });\n    },\n    genTestUserSig: function genTestUserSig() {\n      var USERID = this.userId;\n      var SDKAPPID = this.sdkAppId;\n      var EXPIRETIME = 604800;\n      var SECRETKEY = this.userToken;\n\n      if (SDKAPPID === '' || SECRETKEY === '') {\n        alert('请先配置好您的账号信息： SDKAPPID 及 SECRETKEY ' + '\\r\\n\\r\\nPlease configure your SDKAPPID/SECRETKEY in js/debug/GenerateTestUserSig.js');\n      }\n\n      var generator = new window.LibGenerateTestUserSig(SDKAPPID, SECRETKEY, EXPIRETIME);\n      var userSig = generator.genTestUserSig(USERID);\n      return {\n        sdkAppId: SDKAPPID,\n        userSig: userSig\n      };\n    }\n  }\n};",{"version":3,"sources":["voice.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div id=\"app\">\r\n    <el-button type=\"primary\" @click=\"createClient\" v-if=\"!isLink\" size=\"mini\">连麦</el-button>\r\n    <el-button type=\"primary\" @click=\"signOut\" v-else>退出语音</el-button>\r\n    <div id='local_stream' class='video'></div>\r\n    <template v-for=\"item in remoteVideo\" >\r\n      <div :id=\"'remote_stream'+ item\" class='video' :key='item'></div>\r\n    </template>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport TRTC from 'trtc-js-sdk'\r\nimport {TEST_ACCOUNT} from '../const/account_dev'\r\n import {mapState} from 'vuex'\r\nexport default {\r\n  name: 'voiceCommunicate',\r\n  components: {\r\n  },\r\n  data() {\r\n    return {\r\n      sdkAppId: TEST_ACCOUNT.sdkAppId,\r\n      userId: TEST_ACCOUNT.userId + (Math.random() * 100).toFixed(),\r\n      userToken: TEST_ACCOUNT.userToken,\r\n      client: '',\r\n      localStream: '',\r\n      roomId: this.$store.state.currentRoomId,\r\n      remoteVideo: [],\r\n      isSignUp: false,\r\n      isLink: false,\r\n    }\r\n  },\r\n  created() {\r\n  },\r\n  methods: {\r\n        voicecommunicate(linkOrder) {\r\n            if(this.isLink==false&& linkOrder==true)\r\n            {\r\n                this.isLink=true\r\n                this.createClient()\r\n            }else{\r\n                if(this.isLink==true&&linkOrder==false)\r\n                {\r\n                  this.isLink==false\r\n                  this.signOut()\r\n                }\r\n            }\r\n        },\r\n       createClient() {\r\n      //获取签名\r\n      const config = this.genTestUserSig()\r\n      const sdkAppId = config.sdkAppId\r\n      const userSig = config.userSig\r\n      this.client = TRTC.createClient({\r\n        mode: 'videoCall',\r\n        sdkAppId,\r\n        userId: this.userId,\r\n        userSig,\r\n      })\r\n      console.log(sdkAppId,this.userId,userSig,111111111)\r\n      //注册远程监听，要放在加入房间前--这里用了发布订阅模式\r\n      this.subscribeStream()\r\n      this.joinRoom(this.roomId)\r\n\r\n    },\r\n\r\n    //加入房间\r\n    joinRoom (roomId) {\r\n      console.log(roomId)\r\n      if(!this.isSignUp) {\r\n        this.client.join({ roomId })\r\n          .then(() => {\r\n            console.log('进房成功')\r\n            this.isSignUp = true\r\n            //创建本地流\r\n            this.createStream(this.userId)\r\n            // //播放远端流\r\n            this.playRemoteStream(this.client)\r\n            this.isLink = true\r\n          })\r\n          .catch(error => {\r\n            console.error('进房失败 ' + error)\r\n          })\r\n      } else {\r\n        alert('不能重复加入直播间')\r\n      }\r\n\r\n    },\r\n\r\n    createStream(userId) {\r\n      const localStream = TRTC.createStream({ userId, audio: true, video: false })\r\n      this.localStream =localStream\r\n\r\n      localStream\r\n        .initialize()\r\n        .catch(error => {\r\n          console.error('初始化本地流失败 ' + error)\r\n        })\r\n        .then(() => {\r\n          console.log('初始化本地流成功')\r\n          localStream.play('local_stream')\r\n          //创建好后才能发布\r\n          this.publishStream(localStream)\r\n        })\r\n    },\r\n\r\n    publishStream(localStream) {\r\n      this.client\r\n        .publish(localStream)\r\n        .catch(error => {\r\n          console.error('本地流发布失败 ' + error)\r\n        })\r\n        .then(() => {\r\n          console.log('本地流发布成功')\r\n        })\r\n    },\r\n\r\n    playRemoteStream() {\r\n      this.client.on('stream-subscribed', event => {\r\n        const remoteStream = event.stream\r\n        console.log('远端流订阅成功：' + remoteStream.getId())\r\n        this.remoteVideo.push(remoteStream.getId())\r\n        // 播放远端流\r\n        this.$nextTick(()=>{\r\n        remoteStream.play('remote_stream'+ remoteStream.getId())\r\n        },1000)\r\n\r\n      })\r\n\r\n    },\r\n\r\n    //订阅远端流--加入房间之前\r\n    subscribeStream () {\r\n      this.client.on('stream-added', event => {\r\n        const remoteStream = event.stream\r\n        console.log('远端流增加: ' + remoteStream.getId())\r\n        //订阅远端流\r\n        this.client.subscribe(remoteStream)\r\n      })\r\n    },\r\n\r\n    signOut() {\r\n      this.isSignUp=false\r\n      this.remoteVideo=[]\r\n      this.client\r\n      .leave()\r\n      .then(() => {\r\n        // 退房成功，可再次调用client.join重新进房开启新的通话。\r\n        console.log('退出直播间')\r\n        this.isLink = false\r\n      })\r\n      .catch(error => {\r\n        console.error('退出直播间失败 ' + error)\r\n        // 错误不可恢复，需要刷新页面。\r\n      })\r\n    },\r\n\r\n    genTestUserSig() {\r\n      const USERID = this.userId\r\n      const SDKAPPID = this.sdkAppId\r\n      const EXPIRETIME = 604800\r\n      const SECRETKEY = this.userToken\r\n      if (SDKAPPID === '' || SECRETKEY === '') {\r\n        alert(\r\n          '请先配置好您的账号信息： SDKAPPID 及 SECRETKEY ' +\r\n            '\\r\\n\\r\\nPlease configure your SDKAPPID/SECRETKEY in js/debug/GenerateTestUserSig.js'\r\n        )\r\n      }\r\n      const generator = new window.LibGenerateTestUserSig(SDKAPPID, SECRETKEY, EXPIRETIME)\r\n      const userSig = generator.genTestUserSig(USERID)\r\n      return {\r\n        sdkAppId: SDKAPPID,\r\n        userSig: userSig\r\n      }\r\n    }\r\n    }\r\n}\r\n</script>\r\n"],"sourceRoot":"src/components"}]}