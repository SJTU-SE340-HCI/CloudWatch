{"remainingRequest":"D:\\HCI\\github\\node_modules\\thread-loader\\dist\\cjs.js!D:\\HCI\\github\\node_modules\\babel-loader\\lib\\index.js!D:\\HCI\\github\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\HCI\\github\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\HCI\\github\\src\\components\\user\\login.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\HCI\\github\\src\\components\\user\\login.vue","mtime":1593418846940},{"path":"D:\\HCI\\github\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589122691350},{"path":"D:\\HCI\\github\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1589122702323},{"path":"D:\\HCI\\github\\node_modules\\babel-loader\\lib\\index.js","mtime":1589122690916},{"path":"D:\\HCI\\github\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589122691350},{"path":"D:\\HCI\\github\\node_modules\\vue-loader\\lib\\index.js","mtime":1589122702780}],"contextDependencies":[],"result":["import _FormItem2 from \"element-ui/lib/theme-chalk/form-item.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _FormItem from \"element-ui/lib/form-item\";\nimport _Form2 from \"element-ui/lib/theme-chalk/form.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Form from \"element-ui/lib/form\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport logo from \"../../assets/image/logo.png\";\nimport axios from 'axios';\nexport default {\n  name: 'Login',\n  components: {\n    ElForm: _Form,\n    ElFormItem: _FormItem\n  },\n  data: function data() {\n    var _this = this;\n\n    var checkUserID = function checkUserID(rule, value, callback) {\n      if (!/^[a-zA-Z][a-zA-Z0-9_]{3,23}$/.test(value)) {\n        callback(new Error('不合法（字母开头+字母/数字，长度4-24)'));\n      } else {\n        callback();\n      }\n    };\n\n    var checkRoomNumber = function checkRoomNumber(rule, value, callback) {\n      if (!/^[1-9][0-9]{0,9}$/.test(value)) {\n        callback(new Error('不合法自然数，长度1-10'));\n      } else {\n        callback();\n      }\n    };\n\n    var password_check = function password_check(rule, value, callback) {\n      if (value !== _this.register_data.password) {\n        callback(new Error('两次输入密码不一致!'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      form: {\n        userID: '',\n        password: '',\n        room: ''\n      },\n      register_data: {\n        userID: '',\n        password: '',\n        password_check: ''\n      },\n      rules: {\n        userID: [{\n          required: true,\n          message: '请输入 userID',\n          trigger: 'blur'\n        }, {\n          validator: checkUserID,\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '请输入密码',\n          trigger: 'blur'\n        }],\n        password_check: [{\n          required: true,\n          message: '请再次输入密码',\n          trigger: 'blur'\n        }, {\n          validator: password_check,\n          trigger: 'blur'\n        }],\n        room: [{\n          required: true,\n          message: '请输入房间号',\n          trigger: 'blur'\n        }, {\n          validator: checkRoomNumber,\n          trigger: 'blur'\n        }]\n      },\n      logo: logo,\n      registerVisible: false,\n      loading: false,\n      isRegister: false\n    };\n  },\n  methods: {\n    handleEnter: function handleEnter() {\n      if (this.isRegister) {\n        this.register();\n      } else {\n        this.submit();\n      }\n    },\n    submit: function submit() {\n      var _this2 = this;\n\n      this.$refs['login'].validate(function (valid) {\n        if (valid) {\n          _this2.login();\n        }\n      });\n    },\n    register: function register() {\n      var _this3 = this;\n\n      this.$refs['register_data'].validate(function (valid) {\n        if (valid) {\n          axios.post('http://47.103.30.166:8020/User/register', {\n            accountUser: _this3.register_data.userID,\n            passwordUser: _this3.register_data.password\n          }).then(function (res) {\n            if (res.data == 'success') {\n              _this3.$store.commit('showMessage', {\n                type: 'success',\n                message: '注册成功'\n              });\n\n              _this3.isRegister = true;\n            }\n\n            if (res.data == 'account already exist') {\n              _this3.$store.commit('showMessage', {\n                type: 'error',\n                message: '用户id \"' + _this3.register_data.userID + '\" 已存在'\n              });\n            }\n          }).catch(function (err) {\n            console.log(err);\n          });\n        }\n      });\n    },\n    login: function login() {\n      var _this4 = this;\n\n      this.loading = true;\n      axios.get('http://47.103.30.166:8020/User/SignIn', {\n        params: {\n          account: this.form.userID,\n          password: this.form.password\n        }\n      }).then(function (res) {\n        var signInRes = res.data;\n\n        if (signInRes === 'invalid account') {\n          _this4.$store.commit('showMessage', {\n            type: 'error',\n            message: '帐号不存在'\n          });\n\n          _this4.loading = false;\n          return;\n        } else {\n          if (signInRes === 'invalid password') {\n            _this4.$store.commit('showMessage', {\n              type: 'error',\n              message: '密码不正确'\n            });\n\n            _this4.loading = false;\n            return;\n          } else {\n            _this4.$store.commit('updateUserID', res.data);\n\n            _this4.tim.login({\n              userID: _this4.form.userID,\n              userSig: window.genTestUserSig(_this4.form.userID).userSig\n            }).then(function () {\n              _this4.loading = false;\n\n              _this4.$store.commit('startComputeCurrent');\n\n              _this4.$store.commit({\n                type: 'GET_USER_INFO',\n                userID: _this4.form.userID,\n                userSig: window.genTestUserSig(_this4.form.userID).userSig,\n                sdkAppID: window.genTestUserSig('').SDKAppID\n              });\n\n              _this4.$store.commit('toggleIsLogin', true);\n\n              _this4.$store.commit('showMessage', {\n                type: 'success',\n                message: '登录成功'\n              });\n            }).catch(function (error) {\n              _this4.loading = false;\n\n              _this4.$store.commit('showMessage', {\n                message: '登录失败：' + error.message,\n                type: 'error'\n              });\n            });\n          }\n        }\n      });\n    }\n  }\n};",null]}