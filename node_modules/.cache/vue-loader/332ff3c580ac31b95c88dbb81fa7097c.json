{"remainingRequest":"D:\\HCI\\github\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\HCI\\github\\src\\components\\video\\video.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\HCI\\github\\src\\components\\video\\video.vue","mtime":1593418846941},{"path":"D:\\HCI\\github\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589122691350},{"path":"D:\\HCI\\github\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1589122702323},{"path":"D:\\HCI\\github\\node_modules\\babel-loader\\lib\\index.js","mtime":1589122690916},{"path":"D:\\HCI\\github\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589122691350},{"path":"D:\\HCI\\github\\node_modules\\vue-loader\\lib\\index.js","mtime":1589122702780}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport axios from 'axios'\nimport TcVod from 'vod-js-sdk-v6'\nimport {Upload, Progress} from 'element-ui'\n\nexport default {\n  name: 'TcPlayer',\n  props: {\n    isFullscreen: Boolean,\n  },\n  computed: {\n    isFull: function () {\n      return this.isFullscreen\n    }\n  },\n  components: {\n    ElUpload: Upload,\n    ElProgress: Progress\n  },\n  data() {\n    return {\n      tcPlayerId: 'tcPlayer' + Date.now(),\n      player: null,\n      RoomId: 'x2RYna',\n      showList:false,\n      showVideo:false,\n      showJindu:false,\n      uploader: null,\n      jindu:0,\n      Fileid: '5285890804272485428',\n      Appid: '1301931404',\n      list: [\n        {\n          cover:require('../../assets/image/video.jpg'),\n          name:'主题曲片花',\n          fileId:'5285890804129534917',\n          text:'简介1'\n        },\n        {\n          cover:require('../../assets/image/video.jpg'),\n          name:'一路向北',\n          fileId:'5285890804272485428',\n          text:'简介2'\n        },\n        {\n          cover:require('../../assets/image/video.jpg'),\n          name:'live',\n          fileId:'5285890801792789133',\n          text:'简介3'\n        },\n        {\n          cover:require('../../assets/image/video.jpg'),\n          name:'浪姐',\n          fileId:'5285890804347869645',\n          text:'简介4'\n        },\n        {\n          cover:require('../../assets/image/video.jpg'),\n          name:'庆佘年',\n          fileId:'5285890804447813743',\n          text:'简介5'\n        },\n        {\n          cover:require('../../assets/image/video.jpg'),\n          name:'浪姐预告',\n          fileId:'5285890804334475959',\n          text:'简介6'\n        }\n      ]\n    }\n  },\n  mounted() {\n    let self = this\n    this.$nextTick(() => {\n      setTimeout(() => {\n        let videoFileid = this.Fileid\n        let videoAppid = this.Appid\n        self.getVideoLang(videoFileid, videoAppid)\n      }, 400)\n    })\n  },\n  methods: {\n    tt(event) {\n      window.console.log(event)\n    },\n    // 初始化腾讯云播放器\n    getVideoLang(fileID, appID) {\n      const playerParam = {\n        fileID: fileID,\n        appID: appID\n      }\n      this.player = window.TCPlayer(this.tcPlayerId, playerParam)\n      if (this.$store.state.currentRoom.kindRoom==1) {\n        this.player.on('play',this.beginRecord)\n        this.player.on('pause', this.finishRecord)\n      }\n    },\n\n    // 视频状态改变回调函数，用户录制\n    beginRecord() {\n      this.$store.commit('setVideoRoomId', this.Fileid)\n      axios.get('http://47.103.30.166:8020/Room/setSDK', {\n        params: {\n          room_id: this.$store.state.currentRoomId,\n          video_id: this.$store.state.currentVideoRoomId\n        }\n      })\n      this.$parent.beginRecord()\n    },\n    finishRecord() {\n      this.$parent.finishRecord()\n    },\n    playVideo() {\n      let self = this\n      let time = this.player.currentTime()\n      //alert(time)\n      axios.get('http://47.103.30.166:8020/videoroom/play', {\n        params: {\n          RoomId: this.RoomId,\n          curTime: time\n        }\n      }).then(function (response) {\n        //alert(response.data)\n        //if(player.paused){\n        //  setInterval(pause,5000);\n        //}\n        if (Math.abs(response.data - time) > 0.5) {\n          self.player.currentTime(response.data + 1)\n        }\n      })\n    },\n    TongBu() {\n      //alert('test')\n      this.player.on('playing', setInterval(this.playvideo, 2000))\n    },\n\n    getSignature() {\n      return axios.post('http://47.103.30.166:8020/videoroom/signature')\n        .then(function (response) {\n          //alert(response.data)\n          console.log(response)\n          return response.data\n        })\n    },\n    cancelUploader() {\n      this.uploader.cancel()\n      this.showJindu = false\n    },\n    ShangChuan(event) {\n      let self = this\n      if (this.uploader != null) {\n        this.uploader.cancel()\n      }\n      //let file = document.querySelector('input[type=file]')\n      //let mediaFile = file.files[0]\n      let mediaFile = event.raw\n      const tcVod = new TcVod({\n        getSignature: this.getSignature // 前文中所述的获取上传签名的函数\n      })\n      this.uploader = tcVod.upload({\n        mediaFile: mediaFile, // 媒体文件（视频或音频或图片），类型为 File\n      })\n      this.uploader.on('media_progress', function (info) {\n        self.showJindu=true\n        window.console.log(info.percent) // 进度\n        self.jindu=info.percent*100\n      })\n      this.uploader.done().then(function (doneResult) {\n        self.showJindu=false\n        self.Fileid=doneResult.fileId\n        self.player.loadVideoByID({\n          fileID: self.Fileid, // 请传入需要播放的视频 filID（必须）\n          appID: self.Appid, // 请传入点播账号的 appID（必须）\n        })\n        self.showVideo=true\n        self.$parent.showVideo=true\n      })\n    },\n\n    showVideoList() {\n      this.showList=!this.showList\n    },\n    changeVideo(fileID) {\n      this.Fileid=fileID\n      this.player.loadVideoByID({\n        fileID: this.Fileid, // 请传入需要播放的视频 filID（必须）\n        appID: this.Appid, // 请传入点播账号的 appID（必须）\n      })\n      this.showVideo=true\n      this.$parent.showVideo=true\n      if (this.uploader != null) {\n        this.uploader.cancel()\n      }\n    }\n  }\n}\n",null]}