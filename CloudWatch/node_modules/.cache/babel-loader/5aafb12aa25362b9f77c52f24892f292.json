{"remainingRequest":"D:\\HCI\\CloudWatch\\node_modules\\babel-loader\\lib\\index.js!D:\\HCI\\CloudWatch\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\HCI\\CloudWatch\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\HCI\\CloudWatch\\src\\components\\conversation\\conversation-list.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\HCI\\CloudWatch\\src\\components\\conversation\\conversation-list.vue","mtime":1589001011121},{"path":"D:\\HCI\\CloudWatch\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589000993815},{"path":"D:\\HCI\\CloudWatch\\node_modules\\babel-loader\\lib\\index.js","mtime":1589000993275},{"path":"D:\\HCI\\CloudWatch\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589000993815},{"path":"D:\\HCI\\CloudWatch\\node_modules\\vue-loader\\lib\\index.js","mtime":1589001009411}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.array.find-index\";\nimport _defineProperty from \"D:\\\\HCI\\\\CloudWatch\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport ConversationItem from \"./conversation-item\";\nimport { mapState } from 'vuex';\nexport default {\n  name: 'ConversationList',\n  components: {\n    ConversationItem: ConversationItem\n  },\n  data: function data() {\n    return {\n      showDialog: false,\n      userID: '',\n      isCheckouting: false,\n      // 是否正在切换会话\n      timeout: null\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    conversationList: function conversationList(state) {\n      return state.conversation.conversationList;\n    },\n    currentConversation: function currentConversation(state) {\n      return state.conversation.currentConversation;\n    }\n  })),\n  mounted: function mounted() {\n    window.addEventListener('keydown', this.handleKeydown);\n  },\n  destroyed: function destroyed() {\n    window.removeEventListener('keydown', this.handleKeydown);\n  },\n  methods: {\n    handleRefresh: function handleRefresh() {\n      this.refreshConversation()();\n    },\n    refreshConversation: function refreshConversation() {\n      var that = this;\n      return function () {\n        if (!that.timeout) {\n          that.timeout = setTimeout(function () {\n            that.timeout = null;\n            that.tim.getConversationList().then(function () {\n              that.$store.commit('showMessage', {\n                message: '刷新成功',\n                type: 'success'\n              });\n            });\n          }, 1000);\n        }\n      };\n    },\n    handleAddButtonClick: function handleAddButtonClick() {\n      this.showDialog = true;\n    },\n    handleConfirm: function handleConfirm() {\n      var _this = this;\n\n      if (this.userID !== '@TIM#SYSTEM') {\n        this.$store.dispatch('checkoutConversation', \"C2C\".concat(this.userID)).then(function () {\n          _this.showDialog = false;\n        }).catch(function () {\n          _this.$store.commit('showMessage', {\n            message: '没有找到该用户',\n            type: 'warning'\n          });\n        });\n      } else {\n        this.$store.commit('showMessage', {\n          message: '没有找到该用户',\n          type: 'warning'\n        });\n      }\n\n      this.userID = '';\n    },\n    handleKeydown: function handleKeydown(event) {\n      var _this2 = this;\n\n      if (event.keyCode !== 38 && event.keyCode !== 40 || this.isCheckouting) {\n        return;\n      }\n\n      var currentIndex = this.conversationList.findIndex(function (item) {\n        return item.conversationID === _this2.currentConversation.conversationID;\n      });\n\n      if (event.keyCode === 38 && currentIndex - 1 >= 0) {\n        this.checkoutPrev(currentIndex);\n      }\n\n      if (event.keyCode === 40 && currentIndex + 1 < this.conversationList.length) {\n        this.checkoutNext(currentIndex);\n      }\n    },\n    checkoutPrev: function checkoutPrev(currentIndex) {\n      var _this3 = this;\n\n      this.isCheckouting = true;\n      this.$store.dispatch('checkoutConversation', this.conversationList[currentIndex - 1].conversationID).then(function () {\n        _this3.isCheckouting = false;\n      }).catch(function () {\n        _this3.isCheckouting = false;\n      });\n    },\n    checkoutNext: function checkoutNext(currentIndex) {\n      var _this4 = this;\n\n      this.isCheckouting = true;\n      this.$store.dispatch('checkoutConversation', this.conversationList[currentIndex + 1].conversationID).then(function () {\n        _this4.isCheckouting = false;\n      }).catch(function () {\n        _this4.isCheckouting = false;\n      });\n    }\n  }\n};",{"version":3,"sources":["conversation-list.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"list-container\">\r\n    <div class=\"header-bar\">\r\n      <button title=\"刷新列表\" @click=\"handleRefresh\">\r\n        <i class=\"tim-icon-refresh\"></i>\r\n      </button>\r\n      <button title=\"创建会话\" @click=\"handleAddButtonClick\">\r\n        <i class=\"tim-icon-add\"></i>\r\n      </button>\r\n    </div>\r\n    <div class=\"scroll-container\">\r\n      <conversation-item\r\n        :conversation=\"item\"\r\n        v-for=\"item in conversationList\"\r\n        :key=\"item.conversationID\"\r\n      />\r\n    </div>\r\n    <el-dialog title=\"快速发起会话\" :visible.sync=\"showDialog\" width=\"30%\">\r\n      <el-input placeholder=\"请输入用户ID\" v-model=\"userID\" @keydown.enter.native=\"handleConfirm\"/>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"showDialog = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleConfirm\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport ConversationItem from './conversation-item'\r\nimport { mapState } from 'vuex'\r\nexport default {\r\n  name: 'ConversationList',\r\n  components: { ConversationItem },\r\n  data() {\r\n    return {\r\n      showDialog: false,\r\n      userID: '',\r\n      isCheckouting: false, // 是否正在切换会话\r\n      timeout: null\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      conversationList: state => state.conversation.conversationList,\r\n      currentConversation: state => state.conversation.currentConversation\r\n    })\r\n  },\r\n  mounted() {\r\n    window.addEventListener('keydown', this.handleKeydown)\r\n  },\r\n  destroyed() {\r\n    window.removeEventListener('keydown', this.handleKeydown)\r\n  },\r\n  methods: {\r\n    handleRefresh() {\r\n      this.refreshConversation()()\r\n    },\r\n    refreshConversation() {\r\n      let that = this\r\n      return function () {\r\n        if (!that.timeout) {\r\n          that.timeout = setTimeout(() =>{\r\n            that.timeout = null\r\n            that.tim.getConversationList().then(() => {\r\n              that.$store.commit('showMessage', {\r\n                message: '刷新成功',\r\n                type: 'success'\r\n              })\r\n            })\r\n          }, 1000)\r\n        }\r\n      }\r\n    },\r\n    handleAddButtonClick() {\r\n      this.showDialog = true\r\n    },\r\n    handleConfirm() {\r\n      if (this.userID !== '@TIM#SYSTEM') {\r\n        this.$store\r\n          .dispatch('checkoutConversation', `C2C${this.userID}`)\r\n          .then(() => {\r\n            this.showDialog = false\r\n          }).catch(() => {\r\n          this.$store.commit('showMessage', {\r\n            message: '没有找到该用户',\r\n            type: 'warning'\r\n          })\r\n        })\r\n      } else {\r\n        this.$store.commit('showMessage', {\r\n          message: '没有找到该用户',\r\n          type: 'warning'\r\n        })\r\n      }\r\n      this.userID = ''\r\n    },\r\n    handleKeydown(event) {\r\n      if (event.keyCode !== 38 && event.keyCode !== 40 || this.isCheckouting) {\r\n        return\r\n      }\r\n      const currentIndex = this.conversationList.findIndex(\r\n        item => item.conversationID === this.currentConversation.conversationID\r\n      )\r\n      if (event.keyCode === 38 && currentIndex - 1 >= 0) {\r\n        this.checkoutPrev(currentIndex)\r\n      }\r\n      if (\r\n        event.keyCode === 40 &&\r\n        currentIndex + 1 < this.conversationList.length\r\n      ) {\r\n        this.checkoutNext(currentIndex)\r\n      }\r\n    },\r\n    checkoutPrev(currentIndex) {\r\n      this.isCheckouting = true\r\n      this.$store\r\n        .dispatch(\r\n          'checkoutConversation',\r\n          this.conversationList[currentIndex - 1].conversationID\r\n        )\r\n        .then(() => {\r\n          this.isCheckouting = false\r\n        })\r\n        .catch(() => {\r\n          this.isCheckouting = false\r\n        })\r\n    },\r\n    checkoutNext(currentIndex) {\r\n      this.isCheckouting = true\r\n      this.$store\r\n        .dispatch(\r\n          'checkoutConversation',\r\n          this.conversationList[currentIndex + 1].conversationID\r\n        )\r\n        .then(() => {\r\n          this.isCheckouting = false\r\n        })\r\n        .catch(() => {\r\n          this.isCheckouting = false\r\n        })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n.list-container\r\n  height 100%\r\n  width 100%\r\n  display flex\r\n  flex-direction column // -reverse\r\n  .header-bar\r\n    flex-shrink 0\r\n    height 50px\r\n    border-bottom 1px solid $background-deep-dark\r\n    padding 10px 10px 10px 20px\r\n    button\r\n      float right\r\n      display: inline-block;\r\n      cursor: pointer;\r\n      background $background-deep-dark\r\n      border: none\r\n      color: $font-dark;\r\n      box-sizing: border-box;\r\n      transition: .3s;\r\n      -moz-user-select: none;\r\n      -webkit-user-select: none;\r\n      -ms-user-select: none;\r\n      margin: 0 10px 0 0\r\n      padding 0\r\n      width 30px\r\n      height 30px\r\n      line-height 34px\r\n      font-size: 24px;\r\n      text-align: center;\r\n      white-space: nowrap;\r\n      border-radius: 50%\r\n      outline 0\r\n      &:hover\r\n        // background $light-primary\r\n        // color $white\r\n        transform: rotate(360deg);\r\n        color $light-primary\r\n  .scroll-container\r\n    overflow-y scroll\r\n    flex 1\r\n.bottom-circle-btn {\r\n  position: absolute;\r\n  bottom: 20px;\r\n  right: 20px;\r\n}\r\n\r\n.refresh {\r\n  bottom: 70px;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/components/conversation"}]}