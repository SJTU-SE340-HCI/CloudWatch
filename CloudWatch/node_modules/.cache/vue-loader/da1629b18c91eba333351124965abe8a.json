{"remainingRequest":"D:\\HCI\\CloudWatch\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\HCI\\CloudWatch\\src\\components\\message\\call-layer.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\HCI\\CloudWatch\\src\\components\\message\\call-layer.vue","mtime":1589001011135},{"path":"D:\\HCI\\CloudWatch\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589000993815},{"path":"D:\\HCI\\CloudWatch\\node_modules\\babel-loader\\lib\\index.js","mtime":1589000993275},{"path":"D:\\HCI\\CloudWatch\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1589000993815},{"path":"D:\\HCI\\CloudWatch\\node_modules\\vue-loader\\lib\\index.js","mtime":1589001009411}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport RtcClient from '../../utils/rtc-client'\r\nimport { ACTION, VERSION } from '../../utils/trtcCustomMessageMap'\r\nimport { mapGetters, mapState } from 'vuex'\r\nimport { formatDuration } from '../../utils/formatDuration'\r\n\r\nexport default {\r\n  name: 'CallLayer',\r\n  data() {\r\n    return {\r\n      Trtc: undefined,\r\n      isCamOn: true,\r\n      isMicOn: true,\r\n      maskShow: false,\r\n      isLocalMain: true, // 本地视频是否是主屏幕显示\r\n      start: 0,\r\n      end: 0,\r\n      duration: 0,\r\n      hangUpTimer: 0, // 通话计时id\r\n      ready: false,\r\n      dialling: false, // 是否拨打电话中\r\n      calling: false, // 是否通话中\r\n      isDialled: false, // 是否被呼叫\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(['toAccount', 'currentConversationType']),\r\n    ...mapState({\r\n      userID: state => state.user.userID,\r\n      userSig: state => state.user.userSig,\r\n      videoRoom: state => state.video.videoRoom,\r\n      sdkAppID: state => state.user.sdkAppID\r\n    }),\r\n    formatDurationStr() {\r\n      return formatDuration(this.duration)\r\n    },\r\n  },\r\n  created() {\r\n    window.addEventListener('beforeunload', () => {\r\n      this.videoCallLogOut()\r\n    })\r\n    window.addEventListener('leave', () => {\r\n      this.videoCallLogOut()\r\n    })\r\n  },\r\n  mounted() {\r\n    this.$bus.$on('isCalled', this.isCalled)\r\n    this.$bus.$on('missCall', this.missCall)\r\n    this.$bus.$on('isRefused', this.isRefused)\r\n    this.$bus.$on('isAccept', this.isAccept)\r\n    this.$bus.$on('isHungUp', this.isHungUp)\r\n    this.$bus.$on('busy', this.busy)\r\n    this.$bus.$on('video-call', this.videoCall)\r\n  },\r\n  beforeDestroy() {\r\n    this.$bus.$off('isCalled', this.isCalled)\r\n    this.$bus.$off('missCall', this.missCall)\r\n    this.$bus.$off('isRefused', this.isRefused)\r\n    this.$bus.$off('isAccept', this.isAccept)\r\n    this.$bus.$off('isHungUp', this.isHungUp)\r\n    this.$bus.$off('busy', this.busy)\r\n    this.$bus.$off('video-call', this.videoCall)\r\n  },\r\n  methods: {\r\n    videoCallLogOut() { // 针对，刷新页面，关闭Tab，登出情况下，通话断开的逻辑\r\n      if (this.dialling || this.calling) {\r\n        this.leave()\r\n      }\r\n      if (this.isDialled) {\r\n        this.refuse()\r\n      }\r\n    },\r\n    changeState(state, boolean) {\r\n      let stateList = ['dialling', 'isDialled', 'calling']\r\n      stateList.forEach(item => {\r\n        this[item] = item === state ? boolean : false\r\n      })\r\n      this.$store.commit('UPDATE_ISBUSY', stateList.some(item => this[item])) // 若stateList 中存在 true , isBusy 为 true\r\n    },\r\n    async initTrtc(options) { // 初始化 trtc 进入房间\r\n      this.Trtc = new RtcClient(options)\r\n      await this.Trtc.createLocalStream({ audio: true, video: true }).then(() => { // 在进房之前，判断设备\r\n          this.Trtc.join()\r\n          this.ready = true\r\n          this.isCamOn = true\r\n          this.maskShow = false\r\n      }).catch(() => {\r\n        alert(\r\n          '请确认已连接摄像头和麦克风并授予其访问权限！'\r\n        )\r\n        this.ready = false\r\n      })\r\n    },\r\n    videoCall() { // 发起通话\r\n      if (this.calling) { // 避免通话按钮多次快速的点击\r\n        return\r\n      }\r\n      this.isLocalMain = true\r\n      this.$store.commit('GENERATE_VIDEO_ROOM') // 初始化房间号\r\n      const options = {\r\n        userId: this.userID,\r\n        userSig: this.userSig,\r\n        roomId: this.videoRoom,\r\n        sdkAppId: this.sdkAppID\r\n      }\r\n      this.initTrtc(options).then(() => {\r\n        if (!this.ready) return\r\n        this.changeState('dialling', true)\r\n        this.timer = setTimeout(this.timeout, process.env.NODE_ENV === 'development' ? 999999 : 60000) // 开始计时器，开发环境超时时间较长，便于调试\r\n        this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_DIALING)\r\n      })\r\n    },\r\n    leave() { // 离开房间，发起方挂断\r\n      if (!this.calling) { // 还没有通话，单方面挂断\r\n        this.Trtc.leave()\r\n        clearTimeout(this.timer)\r\n        this.changeState('dialling', false)\r\n        this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_SPONSOR_CANCEL)\r\n        return\r\n      }\r\n      this.hangUp() // 通话一段时间之后，某一方面结束通话\r\n    },\r\n    timeout() { // 通话超时\r\n      this.changeState('dialling', false)\r\n      this.Trtc.leave()\r\n      this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_SPONSOR_TIMEOUT)\r\n    },\r\n    isCalled() { // 被呼叫\r\n      this.changeState('isDialled', true)\r\n    },\r\n    missCall() { // 错过电话，也就是发起方的电话超时挂断或自己挂断\r\n      this.changeState('isDialled', false)\r\n    },\r\n    refuse() { // 拒绝电话\r\n      this.changeState('isDialled', false)\r\n      this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_REJECT)\r\n    },\r\n    isRefused() { // 对方拒绝通话\r\n      this.changeState('dialling', false)\r\n      clearTimeout(this.timer)\r\n    },\r\n    resetDuration(duration) {\r\n      this.duration = duration\r\n      this.hangUpTimer = setTimeout(() => {\r\n        let now = new Date()\r\n        this.resetDuration(parseInt((now - this.start) / 1000))\r\n      }, 1000)\r\n    },\r\n    accept() { // 接听电话\r\n      this.changeState('calling', true)\r\n      const options = {\r\n       userId: this.userID,\r\n        userSig: this.userSig,\r\n        roomId: this.videoRoom,\r\n        sdkAppId: this.sdkAppID\r\n      }\r\n      this.initTrtc(options).then(() => {\r\n        if (!this.ready) {\r\n          this.changeState('calling', false)\r\n          this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_ERROR)\r\n          return\r\n        }\r\n        this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_ACCEPTED)\r\n        this.start = new Date()\r\n        clearTimeout(this.hangUpTimer)\r\n        this.resetDuration(0)\r\n      })\r\n    },\r\n    isAccept() { // 对方接听自己发起的电话\r\n      clearTimeout(this.timer)\r\n      this.changeState('calling', true)\r\n      clearTimeout(this.hangUpTimer)\r\n      this.resetDuration(0)\r\n      this.start = new Date()\r\n    },\r\n    hangUp() { // 通话一段时间之后，某一方挂断电话\r\n      this.changeState('calling', false)\r\n      this.Trtc.leave()\r\n      this.end = new Date()\r\n      const duration = parseInt((this.end - this.start) / 1000)\r\n      this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_HANGUP, duration)\r\n      clearTimeout(this.hangUpTimer)\r\n    },\r\n    isHungUp() { // 通话一段时间之后，对方挂断电话\r\n      if (this.calling) {\r\n        this.changeState('calling', false)\r\n        this.Trtc.leave()\r\n        clearTimeout(this.hangUpTimer)\r\n      }\r\n    },\r\n    busy(videoPayload, messageItem) {\r\n      videoPayload.action = ACTION.VIDEO_CALL_ACTION_LINE_BUSY\r\n      const message = this.tim.createCustomMessage({\r\n        to: messageItem.from,\r\n        conversationType: this.currentConversationType,\r\n        payload: {\r\n          data: JSON.stringify(videoPayload),\r\n          description: '',\r\n          extension: ''\r\n        }\r\n      })\r\n      this.$store.commit('pushCurrentMessageList', message)\r\n      this.tim.sendMessage(message)\r\n    },\r\n    videoHandler() { // 是否打开摄像头\r\n      if (this.isCamOn) {\r\n        this.isCamOn = false\r\n        this.maskShow = true\r\n        this.Trtc.muteLocalVideo()\r\n      } else {\r\n        this.isCamOn = true\r\n        this.maskShow = false\r\n        this.Trtc.unmuteLocalVideo()\r\n      }\r\n    },\r\n    micHandler() { // 是否打开麦克风\r\n      if (this.isMicOn) {\r\n        this.isMicOn = false\r\n        this.Trtc.muteLocalAudio()\r\n      } else {\r\n        this.isMicOn = true\r\n        this.Trtc.unmuteLocalAudio()\r\n      }\r\n    },\r\n    sendVideoMessage(action, duration = 0) {\r\n      const options = {\r\n        room_id: this.videoRoom,\r\n        call_id: '',\r\n        action,\r\n        version: VERSION,\r\n        invited_list: [],\r\n        duration\r\n      }\r\n      const message = this.tim.createCustomMessage({\r\n        to: this.toAccount,\r\n        conversationType: this.currentConversationType,\r\n        payload: {\r\n          data: JSON.stringify(options),\r\n          description: '',\r\n          extension: ''\r\n        }\r\n      })\r\n      this.$store.commit('pushCurrentMessageList', message)\r\n      this.tim.sendMessage(message)\r\n    },\r\n    changeMainVideo() {\r\n      if (!this.calling) {\r\n        return\r\n      }\r\n      this.isLocalMain = !this.isLocalMain\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["call-layer.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"call-layer.vue","sourceRoot":"src/components/message","sourcesContent":["<template>\r\n  <div class=\"call-container\" v-if=\"dialling || calling || isDialled\">\r\n    <div class=\"choose\" v-if=\"isDialled\">\r\n      <div class=\"title\">\r\n        {{ toAccount }}&nbsp;来电话了\r\n      </div>\r\n      <div class=\"buttons\">\r\n        <div class=\"accept\" @click=\"accept\"></div>\r\n        <div class=\"refuse\" @click=\"refuse\"></div>\r\n      </div>\r\n    </div>\r\n    <div class=\"call\" v-if=\"dialling || calling\">\r\n      <div class=\"title\" v-if=\"dialling\">\r\n        正在呼叫&nbsp;{{ toAccount }}...\r\n      </div>\r\n      <div id=\"local\" @click=\"changeMainVideo\" :class=\"isLocalMain ? 'small' : 'big'\" v-show=\"calling\"></div>\r\n      <div name=\"remote\" :class=\"isLocalMain ? 'big' : 'small'\" @click=\"changeMainVideo\" v-show=\"calling\"></div>\r\n      <div class=\"duration\" v-show=\"calling\">\r\n        {{ formatDurationStr }}\r\n      </div>\r\n      <div class=\"buttons\">\r\n        <div :class=\"isCamOn ? 'videoOn' : 'videoOff'\" @click=\"videoHandler\"></div>\r\n        <div class=\"refuse\" @click=\"leave\"></div>\r\n        <div :class=\"isMicOn ? 'micOn' : 'micOff'\" @click=\"micHandler\"></div>\r\n      </div>\r\n      <div class=\"mask\" v-show=\"maskShow\" :class=\"isLocalMain ? 'small' : 'big'\" @click=\"changeMainVideo\">\r\n        <div>\r\n          <img class=\"image\" src=\"../../assets/image/camera-max.png\"/>\r\n          <p class=\"notice\">摄像头未打开</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport RtcClient from '../../utils/rtc-client'\r\nimport { ACTION, VERSION } from '../../utils/trtcCustomMessageMap'\r\nimport { mapGetters, mapState } from 'vuex'\r\nimport { formatDuration } from '../../utils/formatDuration'\r\n\r\nexport default {\r\n  name: 'CallLayer',\r\n  data() {\r\n    return {\r\n      Trtc: undefined,\r\n      isCamOn: true,\r\n      isMicOn: true,\r\n      maskShow: false,\r\n      isLocalMain: true, // 本地视频是否是主屏幕显示\r\n      start: 0,\r\n      end: 0,\r\n      duration: 0,\r\n      hangUpTimer: 0, // 通话计时id\r\n      ready: false,\r\n      dialling: false, // 是否拨打电话中\r\n      calling: false, // 是否通话中\r\n      isDialled: false, // 是否被呼叫\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(['toAccount', 'currentConversationType']),\r\n    ...mapState({\r\n      userID: state => state.user.userID,\r\n      userSig: state => state.user.userSig,\r\n      videoRoom: state => state.video.videoRoom,\r\n      sdkAppID: state => state.user.sdkAppID\r\n    }),\r\n    formatDurationStr() {\r\n      return formatDuration(this.duration)\r\n    },\r\n  },\r\n  created() {\r\n    window.addEventListener('beforeunload', () => {\r\n      this.videoCallLogOut()\r\n    })\r\n    window.addEventListener('leave', () => {\r\n      this.videoCallLogOut()\r\n    })\r\n  },\r\n  mounted() {\r\n    this.$bus.$on('isCalled', this.isCalled)\r\n    this.$bus.$on('missCall', this.missCall)\r\n    this.$bus.$on('isRefused', this.isRefused)\r\n    this.$bus.$on('isAccept', this.isAccept)\r\n    this.$bus.$on('isHungUp', this.isHungUp)\r\n    this.$bus.$on('busy', this.busy)\r\n    this.$bus.$on('video-call', this.videoCall)\r\n  },\r\n  beforeDestroy() {\r\n    this.$bus.$off('isCalled', this.isCalled)\r\n    this.$bus.$off('missCall', this.missCall)\r\n    this.$bus.$off('isRefused', this.isRefused)\r\n    this.$bus.$off('isAccept', this.isAccept)\r\n    this.$bus.$off('isHungUp', this.isHungUp)\r\n    this.$bus.$off('busy', this.busy)\r\n    this.$bus.$off('video-call', this.videoCall)\r\n  },\r\n  methods: {\r\n    videoCallLogOut() { // 针对，刷新页面，关闭Tab，登出情况下，通话断开的逻辑\r\n      if (this.dialling || this.calling) {\r\n        this.leave()\r\n      }\r\n      if (this.isDialled) {\r\n        this.refuse()\r\n      }\r\n    },\r\n    changeState(state, boolean) {\r\n      let stateList = ['dialling', 'isDialled', 'calling']\r\n      stateList.forEach(item => {\r\n        this[item] = item === state ? boolean : false\r\n      })\r\n      this.$store.commit('UPDATE_ISBUSY', stateList.some(item => this[item])) // 若stateList 中存在 true , isBusy 为 true\r\n    },\r\n    async initTrtc(options) { // 初始化 trtc 进入房间\r\n      this.Trtc = new RtcClient(options)\r\n      await this.Trtc.createLocalStream({ audio: true, video: true }).then(() => { // 在进房之前，判断设备\r\n          this.Trtc.join()\r\n          this.ready = true\r\n          this.isCamOn = true\r\n          this.maskShow = false\r\n      }).catch(() => {\r\n        alert(\r\n          '请确认已连接摄像头和麦克风并授予其访问权限！'\r\n        )\r\n        this.ready = false\r\n      })\r\n    },\r\n    videoCall() { // 发起通话\r\n      if (this.calling) { // 避免通话按钮多次快速的点击\r\n        return\r\n      }\r\n      this.isLocalMain = true\r\n      this.$store.commit('GENERATE_VIDEO_ROOM') // 初始化房间号\r\n      const options = {\r\n        userId: this.userID,\r\n        userSig: this.userSig,\r\n        roomId: this.videoRoom,\r\n        sdkAppId: this.sdkAppID\r\n      }\r\n      this.initTrtc(options).then(() => {\r\n        if (!this.ready) return\r\n        this.changeState('dialling', true)\r\n        this.timer = setTimeout(this.timeout, process.env.NODE_ENV === 'development' ? 999999 : 60000) // 开始计时器，开发环境超时时间较长，便于调试\r\n        this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_DIALING)\r\n      })\r\n    },\r\n    leave() { // 离开房间，发起方挂断\r\n      if (!this.calling) { // 还没有通话，单方面挂断\r\n        this.Trtc.leave()\r\n        clearTimeout(this.timer)\r\n        this.changeState('dialling', false)\r\n        this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_SPONSOR_CANCEL)\r\n        return\r\n      }\r\n      this.hangUp() // 通话一段时间之后，某一方面结束通话\r\n    },\r\n    timeout() { // 通话超时\r\n      this.changeState('dialling', false)\r\n      this.Trtc.leave()\r\n      this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_SPONSOR_TIMEOUT)\r\n    },\r\n    isCalled() { // 被呼叫\r\n      this.changeState('isDialled', true)\r\n    },\r\n    missCall() { // 错过电话，也就是发起方的电话超时挂断或自己挂断\r\n      this.changeState('isDialled', false)\r\n    },\r\n    refuse() { // 拒绝电话\r\n      this.changeState('isDialled', false)\r\n      this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_REJECT)\r\n    },\r\n    isRefused() { // 对方拒绝通话\r\n      this.changeState('dialling', false)\r\n      clearTimeout(this.timer)\r\n    },\r\n    resetDuration(duration) {\r\n      this.duration = duration\r\n      this.hangUpTimer = setTimeout(() => {\r\n        let now = new Date()\r\n        this.resetDuration(parseInt((now - this.start) / 1000))\r\n      }, 1000)\r\n    },\r\n    accept() { // 接听电话\r\n      this.changeState('calling', true)\r\n      const options = {\r\n       userId: this.userID,\r\n        userSig: this.userSig,\r\n        roomId: this.videoRoom,\r\n        sdkAppId: this.sdkAppID\r\n      }\r\n      this.initTrtc(options).then(() => {\r\n        if (!this.ready) {\r\n          this.changeState('calling', false)\r\n          this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_ERROR)\r\n          return\r\n        }\r\n        this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_ACCEPTED)\r\n        this.start = new Date()\r\n        clearTimeout(this.hangUpTimer)\r\n        this.resetDuration(0)\r\n      })\r\n    },\r\n    isAccept() { // 对方接听自己发起的电话\r\n      clearTimeout(this.timer)\r\n      this.changeState('calling', true)\r\n      clearTimeout(this.hangUpTimer)\r\n      this.resetDuration(0)\r\n      this.start = new Date()\r\n    },\r\n    hangUp() { // 通话一段时间之后，某一方挂断电话\r\n      this.changeState('calling', false)\r\n      this.Trtc.leave()\r\n      this.end = new Date()\r\n      const duration = parseInt((this.end - this.start) / 1000)\r\n      this.sendVideoMessage(ACTION.VIDEO_CALL_ACTION_HANGUP, duration)\r\n      clearTimeout(this.hangUpTimer)\r\n    },\r\n    isHungUp() { // 通话一段时间之后，对方挂断电话\r\n      if (this.calling) {\r\n        this.changeState('calling', false)\r\n        this.Trtc.leave()\r\n        clearTimeout(this.hangUpTimer)\r\n      }\r\n    },\r\n    busy(videoPayload, messageItem) {\r\n      videoPayload.action = ACTION.VIDEO_CALL_ACTION_LINE_BUSY\r\n      const message = this.tim.createCustomMessage({\r\n        to: messageItem.from,\r\n        conversationType: this.currentConversationType,\r\n        payload: {\r\n          data: JSON.stringify(videoPayload),\r\n          description: '',\r\n          extension: ''\r\n        }\r\n      })\r\n      this.$store.commit('pushCurrentMessageList', message)\r\n      this.tim.sendMessage(message)\r\n    },\r\n    videoHandler() { // 是否打开摄像头\r\n      if (this.isCamOn) {\r\n        this.isCamOn = false\r\n        this.maskShow = true\r\n        this.Trtc.muteLocalVideo()\r\n      } else {\r\n        this.isCamOn = true\r\n        this.maskShow = false\r\n        this.Trtc.unmuteLocalVideo()\r\n      }\r\n    },\r\n    micHandler() { // 是否打开麦克风\r\n      if (this.isMicOn) {\r\n        this.isMicOn = false\r\n        this.Trtc.muteLocalAudio()\r\n      } else {\r\n        this.isMicOn = true\r\n        this.Trtc.unmuteLocalAudio()\r\n      }\r\n    },\r\n    sendVideoMessage(action, duration = 0) {\r\n      const options = {\r\n        room_id: this.videoRoom,\r\n        call_id: '',\r\n        action,\r\n        version: VERSION,\r\n        invited_list: [],\r\n        duration\r\n      }\r\n      const message = this.tim.createCustomMessage({\r\n        to: this.toAccount,\r\n        conversationType: this.currentConversationType,\r\n        payload: {\r\n          data: JSON.stringify(options),\r\n          description: '',\r\n          extension: ''\r\n        }\r\n      })\r\n      this.$store.commit('pushCurrentMessageList', message)\r\n      this.tim.sendMessage(message)\r\n    },\r\n    changeMainVideo() {\r\n      if (!this.calling) {\r\n        return\r\n      }\r\n      this.isLocalMain = !this.isLocalMain\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n.call-container\r\n  background center url(\"data:image/png;base64,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\")\r\n  background-size cover\r\n  position absolute\r\n  z-index 999\r\n.accept, .refuse, .videoOn, .videoOff, .micOn, .micOff\r\n  height 50px\r\n  width 50px\r\n  box-sizing border-box\r\n  border-radius 50%\r\n  cursor:pointer\r\n.accept\r\n  background center no-repeat url(\"../../assets/image/call.png\")\r\n  background-size 60%\r\n  background-color $success\r\n.refuse\r\n  background center no-repeat url(\"../../assets/image/close.png\")\r\n  background-size 70%\r\n  background-color $danger\r\n.videoOn\r\n  background center no-repeat url(\"../../assets/image/big-camera-on.png\")\r\n.videoOff\r\n  background center no-repeat url(\"../../assets/image/big-camera-off.png\")\r\n.micOn\r\n  background center no-repeat url(\"../../assets/image/big-mic-on.png\")\r\n.micOff\r\n  background center no-repeat url(\"../../assets/image/big-mic-off.png\")\r\n.buttons\r\n  position absolute\r\n  z-index 20\r\n  width 70%\r\n  top 75%\r\n  display flex\r\n  justify-content space-around\r\n  margin 0 15% 0 15%\r\n.duration\r\n  color #fff\r\n  position absolute\r\n  z-index 20\r\n  width 100%\r\n  top 70%\r\n  display flex\r\n  justify-content center\r\n.mask\r\n  position absolute\r\n  z-index 10\r\n  background #D8D8D8\r\n  height 100%\r\n  width 100%\r\n  display flex\r\n  align-items center\r\n  justify-content center\r\n  space\r\n  .image\r\n    margin-left 15%\r\n  .notice\r\n    color #888888\r\n.choose, .call\r\n  color #fff\r\n  background-color rgba(0, 0, 0, 0.8)\r\n  height 100%\r\n  width 100%\r\n.title\r\n  margin 25% 0 0 0\r\n  text-align center\r\n  width 100%\r\n  position absolute\r\n  z-index 10\r\n  color  #fff\r\n  font-size 40px\r\n  font-weight 700\r\n.big\r\n  position absolute\r\n  height 100%\r\n  width 100%\r\n.small\r\n  position absolute\r\n  margin-left 74.8%\r\n  z-index 999\r\n  border-style solid\r\n  border-width 1px\r\n  border-color #808080\r\n  height 44.8%\r\n  width 25.2%\r\n</style>"]}]}