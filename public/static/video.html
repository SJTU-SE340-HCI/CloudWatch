<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title></title>
  <link href="https://imgcache.qq.com/open/qcloud/video/tcplayer/tcplayer.css" rel="stylesheet">
  <!--如果需要在 Chrome 和 Firefox 等现代浏览器中通过 H5 播放 HLS 格式的视频，需要在 tcplayer.v4.min.js 之前引入 hls.js。-->
  <script src="https://imgcache.qq.com/open/qcloud/video/tcplayer/libs/hls.min.0.12.4.js"></script>
  <!--播放器脚本文件-->
  <script src="https://imgcache.qq.com/open/qcloud/video/tcplayer/tcplayer.v4.min.js"></script>
  <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="video.css">

</head>
<body>
<!-- 设置播放器容器 -->
<video id="player-container-id" preload="auto" width="720" height="480" playsinline webkit-playsinline
       x5-playsinline></video>

<div style="text-align: center;margin-top: 5px">
  <input type="button" value="创建房间" onclick="CreateRoom()"/>
  <input type="button" value="进入房间" onclick="Show()"/>
</div>
<div style="text-align: center;margin-top: 5px;display: none" id="EnterRoom">
  <p>房间号：<input type="text" style="width: 100px;height: 20px" id="roomid">
    <input type="button" value="确定" onclick="EnterRoom()"/></p>
<div style="text-align: center;margin-top: 5px;display: none" id="isInRoom">
  <p>您已在房间内！</p>
</div>

</div>
<!--
注意事项：
* 播放器容器必须为 video 标签
* player-container-id 为播放器容器的ID，可自行设置
* 播放器区域的尺寸请按需设置，建议通过 css 进行设置，通过css可实现容器自适应等效果
* playsinline webkit-playsinline x5-playsinline 这几个属性是为了在标准移动端浏览器不劫持视频播放的情况下实现行内播放，此处仅作示例，请按需使用
-->
<script>
  var player = TCPlayer("player-container-id", {
    /**player-container-id 为播放器容器ID，必须与html中一致*/
    fileID: "5285890801792789133", /**请传入需要播放的视频fileID 必须 */
    appID: "1301931404", /**请传入点播账号的appID 必须 */
    /**其他参数请在开发文档中查看 */
  });

  function Show() {
    document.getElementById("EnterRoom").style.display = "block";
  }

  function CreateRoom() {
    $.ajax({
      type: 'GET',
      url: 'http://localhost:8080/videoroom',
      success: function (result) {
        alert("创建房间成功！\n房间号：" + result);
      }
    })
  }




  function checkplayer() {
    var isPlay = player.onplaying();
    alert(isPlay);
  }

  function playvideo() {
    var time = player.currentTime();
    var id = document.getElementById("roomid").value;
    $.ajax({
      type: 'POST',
      url: 'http://localhost:8080/videoroom/play',
      async: false,
      data: {
        'roomid': id,
        'curTime': time,
      },
      success: function (data) {
        //alert(data);
        //if(player.paused){
        //  setInterval(pause,5000);
        //}
        //checkplayer();
        if (Math.abs(data-time)>0.5){
          player.currentTime(data+1);
        }
      }

    })
  }

  function EnterRoom() {
    var id = document.getElementById("roomid").value;
    $.ajax({
      type: 'POST',
      url: 'http://localhost:8080/videoroom/room',
      async: false,
      data: {
        'roomid': id,
      },
      success: function (data) {
        if (data) {
          alert("加入房间成功！\n房间号：" + id);
          document.getElementById("isInRoom").style.display = "block";
          //playvideo();
          //setInterval(function () {alert("test");},300s0);
          //setInterval("playvideo()",5000);
          //player.on('play',setInterval(function () {alert("test");},3000));
          player.on('playing',setInterval(playvideo,2000));

        }
        else
          alert("房间不存在！请重试");
      }
    })
  }


</script>
</body>
</html>
